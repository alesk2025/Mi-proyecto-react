{"ast":null,"code":"import _objectSpread from\"C:/Users/User/Downloads/project (10)/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import jsPDF from'jspdf';import html2canvas from'html2canvas';import EconomicReportSummary from'./EconomicManagement/EconomicReportSummary';import AnimalProfitabilitySection from'./EconomicManagement/AnimalProfitabilitySection';import TransactionForm from'./EconomicManagement/TransactionForm';import TransactionHistory from'./EconomicManagement/TransactionHistory';import SupplierClientManagement from'./EconomicManagement/SupplierClientManagement';// Nuevo componente\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EconomicManagementPage=_ref=>{let{transactions,onAddTransaction,onDeleteTransaction,animals,employees,payslips,thirdPartyPayments,currentUser,logoUrl,suppliers,clients,debts,credits,addSupplier,addClient,addDebt,payDebt,addCredit,collectCredit}=_ref;const[transaction,setTransaction]=useState({type:'ingreso',category:'',amount:'',description:'',animalId:'',product:'',quantity:'',unit:'',pricePerUnit:'',client:'',date:new Date().toISOString().split('T')[0],startDate:'',endDate:''});const[reportPeriod,setReportPeriod]=useState('monthly');const[selectedDate,setSelectedDate]=useState(new Date().toISOString().split('T')[0]);const[selectedMonth,setSelectedMonth]=useState(new Date().toISOString().slice(0,7));const[selectedWeek,setSelectedWeek]=useState(getWeekNumber(new Date()));const[sharedExpensesBreakdown,setSharedExpensesBreakdown]=useState({});const sharedExpenseCategories=['alimento','desparasitante','vitaminas','vacunas'];// --- Funciones de Utilidad de Fechas ---\nconst normalizeDate=date=>{const d=new Date(date);d.setHours(0,0,0,0);return d;};function getWeekNumber(d){d=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));d.setUTCDate(d.getUTCDate()+4-(d.getUTCDay()||7));const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));const weekNo=Math.ceil(((d-yearStart)/86400000+1)/7);return{year:d.getUTCFullYear(),week:weekNo};}const getStartAndEndOfWeek=(year,week)=>{const date=new Date(year,0,1+(week-1)*7);const day=date.getDay();const diff=date.getDate()-day+(day===0?-6:1);const startOfWeek=normalizeDate(new Date(date.setDate(diff)));const endOfWeek=normalizeDate(new Date(startOfWeek));endOfWeek.setDate(startOfWeek.getDate()+6);return{start:startOfWeek,end:endOfWeek};};// --- Lógica de Filtrado de Reportes ---\nconst filterItemsBySelectedPeriod=(items,dateProp)=>{return items.filter(item=>{const itemDate=normalizeDate(item[dateProp]);if(reportPeriod==='daily'){const selectedDay=normalizeDate(selectedDate);return itemDate.getTime()===selectedDay.getTime();}else if(reportPeriod==='weekly'){const{start,end}=getStartAndEndOfWeek(selectedWeek.year,selectedWeek.week);return itemDate>=start&&itemDate<=end;}else if(reportPeriod==='monthly'){const[year,month]=selectedMonth.split('-').map(Number);return itemDate.getFullYear()===year&&itemDate.getMonth()===month-1;}return false;});};const currentPeriodTransactions=filterItemsBySelectedPeriod(transactions,'date');const currentPeriodPayslips=filterItemsBySelectedPeriod(payslips,'paymentDate');const currentPeriodThirdPartyPayments=filterItemsBySelectedPeriod(thirdPartyPayments,'date');const totalIncomePeriod=currentPeriodTransactions.filter(t=>t.type==='ingreso'||t.type==='venta').reduce((sum,t)=>sum+t.total,0);const transactionExpensesPeriod=currentPeriodTransactions.filter(t=>t.type==='gasto'||t.type==='compra').reduce((sum,t)=>sum+t.total,0);const payslipExpensesPeriod=currentPeriodPayslips.reduce((sum,ps)=>sum+(parseFloat(ps.netSalary)||0),0);const thirdPartyExpensesPeriod=currentPeriodThirdPartyPayments.reduce((sum,tpp)=>sum+(parseFloat(tpp.amount)||0),0);const totalExpensesPeriod=transactionExpensesPeriod+payslipExpensesPeriod+thirdPartyExpensesPeriod;const netProfitPeriod=totalIncomePeriod-totalExpensesPeriod;// --- Lógica de Rentabilidad por Animal ---\nconst safeEmployees=employees||[];const safeAnimals=animals||[];// Costo de mano de obra (salarios)\n// Se asegura que si no hay empleados, el totalSalaries sea 0\nconst totalSalaries=payslipExpensesPeriod;// Se asegura que si no hay animales, el proratedLaborCostPerAnimal sea 0 para evitar división por cero\nconst proratedLaborCostPerAnimal=safeAnimals.length>0?totalSalaries/safeAnimals.length:0;// Costos compartidos (alimento, desparasitante, vitaminas, vacunas)\nconst totalSharedExpenses=transactions.filter(t=>(t.type==='gasto'||t.type==='compra')&&sharedExpenseCategories.includes(t.category.toLowerCase())).reduce((sum,t)=>sum+t.total,0);const proratedSharedExpensePerAnimal=safeAnimals.length>0?totalSharedExpenses/safeAnimals.length:0;// Gastos de terceros (general y específico)\n// Se asegura que si no hay pagos a terceros, el generalThirdPartyExpenses sea 0\nconst generalThirdPartyExpenses=thirdPartyPayments.filter(tpp=>tpp.appliesTo==='general').reduce((sum,tpp)=>sum+(parseFloat(tpp.amount)||0),0);const proratedGeneralThirdPartyExpensePerAnimal=safeAnimals.length>0?generalThirdPartyExpenses/safeAnimals.length:0;const animalProfitability=safeAnimals.map(animal=>{const animalIncome=transactions.filter(t=>t.animalId===animal.id&&t.type==='venta').reduce((sum,t)=>sum+t.total,0);const animalExpenses=transactions.filter(t=>t.animalId===animal.id&&(t.type==='gasto'||t.type==='compra')&&!sharedExpenseCategories.includes(t.category.toLowerCase())).reduce((sum,t)=>sum+t.total,0);// Gastos de terceros específicos para este animal\nconst specificThirdPartyExpensesForAnimal=thirdPartyPayments.filter(tpp=>tpp.appliesTo==='specific'&&tpp.targetAnimalId===animal.id).reduce((sum,tpp)=>sum+(parseFloat(tpp.amount)||0),0);const totalCost=animalExpenses+proratedLaborCostPerAnimal+proratedSharedExpensePerAnimal+specificThirdPartyExpensesForAnimal+proratedGeneralThirdPartyExpensePerAnimal;const netProfitAnimal=animalIncome-totalCost;return{id:animal.id,name:animal.name,tipoProduccion:animal.tipoProduccion,status:animal.estadoReproductivo,income:animalIncome,expenses:animalExpenses,proratedLabor:proratedLaborCostPerAnimal,// Ahora incluye el salario prorrateado\nproratedSharedExpenses:proratedSharedExpensePerAnimal,specificThirdPartyExpenses:specificThirdPartyExpensesForAnimal,// Nuevo campo\nproratedGeneralThirdPartyExpenses:proratedGeneralThirdPartyExpensePerAnimal,// Nuevo campo\ntotalCost:totalCost,netProfit:netProfitAnimal};});// Efecto para calcular el desglose de gastos compartidos\nuseEffect(()=>{const breakdown={};sharedExpenseCategories.forEach(cat=>{breakdown[cat]=0;});transactions.forEach(t=>{if((t.type==='gasto'||t.type==='compra')&&sharedExpenseCategories.includes(t.category.toLowerCase())){breakdown[t.category.toLowerCase()]+=t.total;}});setSharedExpensesBreakdown(breakdown);},[transactions]);// Información de la finca/criador para PDFs\nconst farmName=(currentUser===null||currentUser===void 0?void 0:currentUser.farmName)||'Mi Finca Ganadera';const adminName=(currentUser===null||currentUser===void 0?void 0:currentUser.fullName)||'Administrador';const defaultLogo='https://via.placeholder.com/50x50?text=LOGO';// Placeholder de logo\nconst calculateTotalSale=()=>{// Moved from TransactionForm\nconst qty=parseFloat(transaction.quantity);const price=parseFloat(transaction.pricePerUnit);return(qty*price).toFixed(2);};const handleSubmit=()=>{// Moved from TransactionForm\nif(!transaction.date){alert('Por favor, selecciona la fecha de la transacción.');return;}if(transaction.type==='ingreso'&&(!transaction.startDate||!transaction.endDate)){alert('Para ingresos, por favor, selecciona la fecha de inicio y fin del período.');return;}let finalTransaction=_objectSpread({},transaction);if(transaction.type==='venta'){finalTransaction.total=parseFloat(calculateTotalSale());}else{finalTransaction.total=parseFloat(transaction.amount);}const newId=\"TRX-\".concat(Date.now().toString().slice(-5));onAddTransaction(_objectSpread(_objectSpread({},finalTransaction),{},{id:newId}));alert(\"Transacci\\xF3n de \".concat(finalTransaction.type,\" registrada por $\").concat(finalTransaction.total,\".\"));// Limpiar formulario\nsetTransaction({type:'ingreso',category:'',amount:'',description:'',animalId:'',product:'',quantity:'',unit:'',pricePerUnit:'',client:'',date:new Date().toISOString().split('T')[0],// Resetear fecha a hoy\nstartDate:'',endDate:''// Resetear campos de fecha de período\n});};const handleGenerateInvoice=saleData=>{if(!saleData||!saleData.client||!saleData.product||!saleData.quantity||!saleData.pricePerUnit){alert('Por favor, completa todos los campos de la venta para generar la factura.');return;}const precioUnitario=parseFloat(saleData.pricePerUnit||0);const cantidad=parseFloat(saleData.quantity||0);const total=cantidad*precioUnitario;const tempDiv=document.createElement('div');tempDiv.style.width='210mm';// A4 width\ntempDiv.style.padding='15mm';// Padding para el contenido\ntempDiv.style.fontFamily='Arial, sans-serif';tempDiv.style.fontSize='10pt';tempDiv.style.backgroundColor='#f8f8f8';// Fondo ligeramente gris\ntempDiv.style.position='absolute';tempDiv.style.left='-9999px';tempDiv.style.top='-9999px';tempDiv.innerHTML=\"\\n      <div style=\\\"border: 1px solid #ddd; border-radius: 12px; overflow: hidden; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1);\\\">\\n        <div style=\\\"background-color: #2c3e50; color: #fff; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-top-left-radius: 10px; border-top-right-radius: 10px;\\\">\\n          <img src=\\\"\".concat(logoUrl||defaultLogo,\"\\\" style=\\\"width: 80px; height: 80px; border-radius: 50%; object-fit: cover;\\\" alt=\\\"Logo Finca\\\">\\n          <div style=\\\"text-align: right;\\\">\\n            <h1 style=\\\"margin: 0; font-size: 24pt; font-weight: bold;\\\">\").concat(farmName,\"</h1>\\n            <p style=\\\"margin: 0; font-size: 12pt; opacity: 0.8;\\\">Factura de Venta</p>\\n          </div>\\n        </div>\\n  \\n        <div style=\\\"padding: 25px;\\\">\\n          <div style=\\\"display: flex; justify-content: space-between; margin-bottom: 20px;\\\">\\n            <div>\\n              <p style=\\\"margin: 0;\\\"><strong>Factura ID:</strong> \").concat(saleData.id||'N/A',\"</p>\\n              <p style=\\\"margin: 0;\\\"><strong>Fecha:</strong> \").concat(saleData.date||'N/A',\"</p>\\n            </div>\\n            <div style=\\\"text-align: right;\\\">\\n              <p style=\\\"margin: 0;\\\"><strong>Cliente:</strong> \").concat(saleData.client||'N/A',\"</p>\\n              <p style=\\\"margin: 0;\\\"><strong>Descripci\\xF3n:</strong> \").concat(saleData.description||'Venta de productos',\"</p>\\n            </div>\\n          </div>\\n  \\n          <table style=\\\"width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 30px;\\\">\\n            <thead style=\\\"background-color: #f0f0f0;\\\">\\n              <tr>\\n                <th style=\\\"padding: 12px; border: 1px solid #eee; text-align: left;\\\">Producto</th>\\n                <th style=\\\"padding: 12px; border: 1px solid #eee; text-align: left;\\\">Cantidad</th>\\n                <th style=\\\"padding: 12px; border: 1px solid #eee; text-align: left;\\\">Unidad</th>\\n                <th style=\\\"padding: 12px; border: 1px solid #eee; text-align: left;\\\">Precio Unitario</th>\\n                <th style=\\\"padding: 12px; border: 1px solid #eee; text-align: left;\\\">Total</th>\\n              </tr>\\n            </thead>\\n            <tbody>\\n              <tr>\\n                <td style=\\\"padding: 12px; border: 1px solid #eee;\\\">\").concat(saleData.product,\"</td>\\n                <td style=\\\"padding: 12px; border: 1px solid #eee;\\\">\").concat(saleData.quantity,\"</td>\\n                <td style=\\\"padding: 12px; border: 1px solid #eee;\\\">\").concat(saleData.unit,\"</td>\\n                <td style=\\\"padding: 12px; border: 1px solid #eee;\\\">$\").concat(precioUnitario.toFixed(2),\"</td>\\n                <td style=\\\"padding: 12px; border: 1px solid #eee;\\\">$\").concat(total.toFixed(2),\"</td>\\n              </tr>\\n            </tbody>\\n          </table>\\n  \\n          <div style=\\\"text-align: right; margin-top: 20px;\\\">\\n            <p style=\\\"font-size: 14pt; font-weight: bold; color: #2c3e50; margin: 0;\\\">Total a Pagar: <span style=\\\"color: #27ae60;\\\">$\").concat(total.toFixed(2),\"</span></p>\\n          </div>\\n        </div>\\n  \\n        <div style=\\\"text-align: center; padding: 20px; background-color: #f0f0f0; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;\\\">\\n          <p style=\\\"font-size: 9pt; color: #555; margin: 0;\\\">\\xA1Gracias por tu compra!</p>\\n        </div>\\n  \\n        <div style=\\\"text-align: right; font-size: 8pt; padding: 10px 20px; color: #aaa; background-color: #f8f8f8; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;\\\">\\n          <p style=\\\"margin: 0;\\\">Generado por Campo Inteligente | Administrador: \").concat(adminName,\"</p>\\n          <p style=\\\"margin: 0;\\\">Fecha de Generaci\\xF3n: \").concat(new Date().toLocaleDateString(),\"</p>\\n        </div>\\n      </div>\\n    \");document.body.appendChild(tempDiv);html2canvas(tempDiv,{scale:2,useCORS:true}).then(canvas=>{const imgData=canvas.toDataURL('image/png');const pdf=new jsPDF('p','mm','a4');const imgWidth=210;const pageHeight=297;const imgHeight=canvas.height*imgWidth/canvas.width;let heightLeft=imgHeight;let position=0;pdf.addImage(imgData,'PNG',0,position,imgWidth,imgHeight);heightLeft-=pageHeight;while(heightLeft>=pageHeight){position=heightLeft-imgHeight;pdf.addPage();pdf.addImage(imgData,'PNG',0,position,imgWidth,imgHeight);heightLeft-=pageHeight;}pdf.save(\"factura_\".concat(saleData.client||'sin_cliente',\"_\").concat(saleData.id||'sin_id',\".pdf\"));document.body.removeChild(tempDiv);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-4\",children:\"Gesti\\xF3n Econ\\xF3mica\"}),/*#__PURE__*/_jsx(EconomicReportSummary,{reportPeriod:reportPeriod,selectedDate:selectedDate,selectedMonth:selectedMonth,selectedWeek:selectedWeek,setSelectedDate:setSelectedDate,setSelectedMonth:setSelectedMonth,setReportPeriod:setReportPeriod,totalIncomePeriod:totalIncomePeriod,totalExpensesPeriod:totalExpensesPeriod,netProfitPeriod:netProfitPeriod}),/*#__PURE__*/_jsx(AnimalProfitabilitySection,{animalProfitability:animalProfitability,totalSharedExpenses:totalSharedExpenses,sharedExpensesBreakdown:sharedExpensesBreakdown}),/*#__PURE__*/_jsx(TransactionForm,{transaction:transaction,handleInputChange:e=>setTransaction(_objectSpread(_objectSpread({},transaction),{},{[e.target.name]:e.target.value})),handleSubmit:handleSubmit,handleGenerateInvoice:handleGenerateInvoice,animals:safeAnimals,calculateTotalSale:calculateTotalSale// Pass calculateTotalSale to TransactionForm\n,suppliers:suppliers,clients:clients,addSupplier:addSupplier,addClient:addClient,debts:debts,credits:credits,addDebt:addDebt,payDebt:payDebt,addCredit:addCredit,collectCredit:collectCredit}),/*#__PURE__*/_jsx(TransactionHistory,{transactions:transactions,onDeleteTransaction:onDeleteTransaction,handleGenerateInvoice:handleGenerateInvoice}),/*#__PURE__*/_jsx(SupplierClientManagement,{suppliers:suppliers,clients:clients,debts:debts,credits:credits,addSupplier:addSupplier,addClient:addClient,addDebt:addDebt,payDebt:payDebt,addCredit:addCredit,collectCredit:collectCredit})]});};export default EconomicManagementPage;","map":{"version":3,"names":["React","useState","useEffect","jsPDF","html2canvas","EconomicReportSummary","AnimalProfitabilitySection","TransactionForm","TransactionHistory","SupplierClientManagement","jsx","_jsx","jsxs","_jsxs","EconomicManagementPage","_ref","transactions","onAddTransaction","onDeleteTransaction","animals","employees","payslips","thirdPartyPayments","currentUser","logoUrl","suppliers","clients","debts","credits","addSupplier","addClient","addDebt","payDebt","addCredit","collectCredit","transaction","setTransaction","type","category","amount","description","animalId","product","quantity","unit","pricePerUnit","client","date","Date","toISOString","split","startDate","endDate","reportPeriod","setReportPeriod","selectedDate","setSelectedDate","selectedMonth","setSelectedMonth","slice","selectedWeek","setSelectedWeek","getWeekNumber","sharedExpensesBreakdown","setSharedExpensesBreakdown","sharedExpenseCategories","normalizeDate","d","setHours","UTC","getFullYear","getMonth","getDate","setUTCDate","getUTCDate","getUTCDay","yearStart","getUTCFullYear","weekNo","Math","ceil","year","week","getStartAndEndOfWeek","day","getDay","diff","startOfWeek","setDate","endOfWeek","start","end","filterItemsBySelectedPeriod","items","dateProp","filter","item","itemDate","selectedDay","getTime","month","map","Number","currentPeriodTransactions","currentPeriodPayslips","currentPeriodThirdPartyPayments","totalIncomePeriod","t","reduce","sum","total","transactionExpensesPeriod","payslipExpensesPeriod","ps","parseFloat","netSalary","thirdPartyExpensesPeriod","tpp","totalExpensesPeriod","netProfitPeriod","safeEmployees","safeAnimals","totalSalaries","proratedLaborCostPerAnimal","length","totalSharedExpenses","includes","toLowerCase","proratedSharedExpensePerAnimal","generalThirdPartyExpenses","appliesTo","proratedGeneralThirdPartyExpensePerAnimal","animalProfitability","animal","animalIncome","id","animalExpenses","specificThirdPartyExpensesForAnimal","targetAnimalId","totalCost","netProfitAnimal","name","tipoProduccion","status","estadoReproductivo","income","expenses","proratedLabor","proratedSharedExpenses","specificThirdPartyExpenses","proratedGeneralThirdPartyExpenses","netProfit","breakdown","forEach","cat","farmName","adminName","fullName","defaultLogo","calculateTotalSale","qty","price","toFixed","handleSubmit","alert","finalTransaction","_objectSpread","newId","concat","now","toString","handleGenerateInvoice","saleData","precioUnitario","cantidad","tempDiv","document","createElement","style","width","padding","fontFamily","fontSize","backgroundColor","position","left","top","innerHTML","toLocaleDateString","body","appendChild","scale","useCORS","then","canvas","imgData","toDataURL","pdf","imgWidth","pageHeight","imgHeight","height","heightLeft","addImage","addPage","save","removeChild","className","children","handleInputChange","e","target","value"],"sources":["C:/Users/User/Downloads/project (10)/src/components/EconomicManagementPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport EconomicReportSummary from './EconomicManagement/EconomicReportSummary';\nimport AnimalProfitabilitySection from './EconomicManagement/AnimalProfitabilitySection';\nimport TransactionForm from './EconomicManagement/TransactionForm';\nimport TransactionHistory from './EconomicManagement/TransactionHistory';\nimport SupplierClientManagement from './EconomicManagement/SupplierClientManagement'; // Nuevo componente\n\nconst EconomicManagementPage = ({ transactions, onAddTransaction, onDeleteTransaction, animals, employees, payslips, thirdPartyPayments, currentUser, logoUrl, suppliers, clients, debts, credits, addSupplier, addClient, addDebt, payDebt, addCredit, collectCredit }) => {\n  const [transaction, setTransaction] = useState({\n    type: 'ingreso',\n    category: '',\n    amount: '',\n    description: '',\n    animalId: '',\n    product: '',\n    quantity: '',\n    unit: '',\n    pricePerUnit: '',\n    client: '',\n    date: new Date().toISOString().split('T')[0],\n    startDate: '',\n    endDate: '',\n  });\n  const [reportPeriod, setReportPeriod] = useState('monthly');\n  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\n  const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));\n  const [selectedWeek, setSelectedWeek] = useState(getWeekNumber(new Date()));\n  const [sharedExpensesBreakdown, setSharedExpensesBreakdown] = useState({});\n  \n\n  const sharedExpenseCategories = ['alimento', 'desparasitante', 'vitaminas', 'vacunas'];\n\n  // --- Funciones de Utilidad de Fechas ---\n  const normalizeDate = (date) => {\n    const d = new Date(date);\n    d.setHours(0, 0, 0, 0);\n    return d;\n  };\n\n  function getWeekNumber(d) {\n    d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));\n    d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));\n    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n    const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);\n    return { year: d.getUTCFullYear(), week: weekNo };\n  }\n\n  const getStartAndEndOfWeek = (year, week) => {\n    const date = new Date(year, 0, 1 + (week - 1) * 7);\n    const day = date.getDay();\n    const diff = date.getDate() - day + (day === 0 ? -6 : 1);\n    const startOfWeek = normalizeDate(new Date(date.setDate(diff)));\n    const endOfWeek = normalizeDate(new Date(startOfWeek));\n    endOfWeek.setDate(startOfWeek.getDate() + 6);\n    return { start: startOfWeek, end: endOfWeek };\n  };\n\n  // --- Lógica de Filtrado de Reportes ---\n  const filterItemsBySelectedPeriod = (items, dateProp) => {\n    return items.filter(item => {\n      const itemDate = normalizeDate(item[dateProp]);\n\n      if (reportPeriod === 'daily') {\n        const selectedDay = normalizeDate(selectedDate);\n        return itemDate.getTime() === selectedDay.getTime();\n      } else if (reportPeriod === 'weekly') {\n        const { start, end } = getStartAndEndOfWeek(selectedWeek.year, selectedWeek.week);\n        return itemDate >= start && itemDate <= end;\n      } else if (reportPeriod === 'monthly') {\n        const [year, month] = selectedMonth.split('-').map(Number);\n        return itemDate.getFullYear() === year && itemDate.getMonth() === (month - 1);\n      }\n      return false;\n    });\n  };\n\n  const currentPeriodTransactions = filterItemsBySelectedPeriod(transactions, 'date');\n  const currentPeriodPayslips = filterItemsBySelectedPeriod(payslips, 'paymentDate');\n  const currentPeriodThirdPartyPayments = filterItemsBySelectedPeriod(thirdPartyPayments, 'date');\n  \n  const totalIncomePeriod = currentPeriodTransactions\n    .filter(t => t.type === 'ingreso' || t.type === 'venta')\n    .reduce((sum, t) => sum + t.total, 0);\n  \n  const transactionExpensesPeriod = currentPeriodTransactions\n    .filter(t => t.type === 'gasto' || t.type === 'compra')\n    .reduce((sum, t) => sum + t.total, 0);\n  \n  const payslipExpensesPeriod = currentPeriodPayslips\n    .reduce((sum, ps) => sum + (parseFloat(ps.netSalary) || 0), 0);\n\n  const thirdPartyExpensesPeriod = currentPeriodThirdPartyPayments\n    .reduce((sum, tpp) => sum + (parseFloat(tpp.amount) || 0), 0);\n  \n  const totalExpensesPeriod = transactionExpensesPeriod + payslipExpensesPeriod + thirdPartyExpensesPeriod;\n\n  const netProfitPeriod = totalIncomePeriod - totalExpensesPeriod;\n\n  // --- Lógica de Rentabilidad por Animal ---\n  const safeEmployees = employees || [];\n  const safeAnimals = animals || [];\n\n  // Costo de mano de obra (salarios)\n  // Se asegura que si no hay empleados, el totalSalaries sea 0\n  const totalSalaries = payslipExpensesPeriod;\n  // Se asegura que si no hay animales, el proratedLaborCostPerAnimal sea 0 para evitar división por cero\n  const proratedLaborCostPerAnimal = safeAnimals.length > 0 ? totalSalaries / safeAnimals.length : 0;\n\n  // Costos compartidos (alimento, desparasitante, vitaminas, vacunas)\n  const totalSharedExpenses = transactions\n    .filter(t => \n      (t.type === 'gasto' || t.type === 'compra') && \n      sharedExpenseCategories.includes(t.category.toLowerCase())\n    )\n    .reduce((sum, t) => sum + t.total, 0);\n\n  const proratedSharedExpensePerAnimal = safeAnimals.length > 0 ? totalSharedExpenses / safeAnimals.length : 0;\n\n  // Gastos de terceros (general y específico)\n  // Se asegura que si no hay pagos a terceros, el generalThirdPartyExpenses sea 0\n  const generalThirdPartyExpenses = thirdPartyPayments\n    .filter(tpp => tpp.appliesTo === 'general')\n    .reduce((sum, tpp) => sum + (parseFloat(tpp.amount) || 0), 0);\n  \n  const proratedGeneralThirdPartyExpensePerAnimal = safeAnimals.length > 0 ? generalThirdPartyExpenses / safeAnimals.length : 0;\n\n\n  const animalProfitability = safeAnimals.map(animal => {\n    const animalIncome = transactions\n      .filter(t => t.animalId === animal.id && t.type === 'venta')\n      .reduce((sum, t) => sum + t.total, 0);\n\n    const animalExpenses = transactions\n      .filter(t => t.animalId === animal.id && (t.type === 'gasto' || t.type === 'compra') && !sharedExpenseCategories.includes(t.category.toLowerCase()))\n      .reduce((sum, t) => sum + t.total, 0);\n\n    // Gastos de terceros específicos para este animal\n    const specificThirdPartyExpensesForAnimal = thirdPartyPayments\n      .filter(tpp => tpp.appliesTo === 'specific' && tpp.targetAnimalId === animal.id)\n      .reduce((sum, tpp) => sum + (parseFloat(tpp.amount) || 0), 0);\n\n    const totalCost = animalExpenses + proratedLaborCostPerAnimal + proratedSharedExpensePerAnimal + specificThirdPartyExpensesForAnimal + proratedGeneralThirdPartyExpensePerAnimal;\n    const netProfitAnimal = animalIncome - totalCost;\n\n    return {\n      id: animal.id,\n      name: animal.name,\n      tipoProduccion: animal.tipoProduccion,\n      status: animal.estadoReproductivo,\n      income: animalIncome,\n      expenses: animalExpenses,\n      proratedLabor: proratedLaborCostPerAnimal, // Ahora incluye el salario prorrateado\n      proratedSharedExpenses: proratedSharedExpensePerAnimal,\n      specificThirdPartyExpenses: specificThirdPartyExpensesForAnimal, // Nuevo campo\n      proratedGeneralThirdPartyExpenses: proratedGeneralThirdPartyExpensePerAnimal, // Nuevo campo\n      totalCost: totalCost,\n      netProfit: netProfitAnimal,\n    };\n  });\n\n  // Efecto para calcular el desglose de gastos compartidos\n  useEffect(() => {\n    const breakdown = {};\n    sharedExpenseCategories.forEach(cat => {\n      breakdown[cat] = 0;\n    });\n\n    transactions.forEach(t => {\n      if ((t.type === 'gasto' || t.type === 'compra') && sharedExpenseCategories.includes(t.category.toLowerCase())) {\n        breakdown[t.category.toLowerCase()] += t.total;\n      }\n    });\n    setSharedExpensesBreakdown(breakdown);\n  }, [transactions]);\n\n  // Información de la finca/criador para PDFs\n  const farmName = currentUser?.farmName || 'Mi Finca Ganadera';\n  const adminName = currentUser?.fullName || 'Administrador';\n  const defaultLogo = 'https://via.placeholder.com/50x50?text=LOGO'; // Placeholder de logo\n\n  const calculateTotalSale = () => { // Moved from TransactionForm\n    const qty = parseFloat(transaction.quantity);\n    const price = parseFloat(transaction.pricePerUnit);\n    return (qty * price).toFixed(2);\n  };\n\n  const handleSubmit = () => { // Moved from TransactionForm\n    if (!transaction.date) {\n      alert('Por favor, selecciona la fecha de la transacción.');\n      return;\n    }\n    if (transaction.type === 'ingreso' && (!transaction.startDate || !transaction.endDate)) {\n      alert('Para ingresos, por favor, selecciona la fecha de inicio y fin del período.');\n      return;\n    }\n\n    let finalTransaction = { ...transaction };\n    if (transaction.type === 'venta') {\n      finalTransaction.total = parseFloat(calculateTotalSale()); \n    } else {\n      finalTransaction.total = parseFloat(transaction.amount);\n    }\n    \n    const newId = `TRX-${Date.now().toString().slice(-5)}`;\n    onAddTransaction({ ...finalTransaction, id: newId });\n    alert(`Transacción de ${finalTransaction.type} registrada por $${finalTransaction.total}.`);\n    // Limpiar formulario\n    setTransaction({\n      type: 'ingreso', category: '', amount: '', description: '',\n      animalId: '', product: '', quantity: '', unit: '', pricePerUnit: '', client: '',\n      date: new Date().toISOString().split('T')[0], // Resetear fecha a hoy\n      startDate: '', endDate: '', // Resetear campos de fecha de período\n    });\n  };\n\n  const handleGenerateInvoice = (saleData) => {\n    if (!saleData || !saleData.client || !saleData.product || !saleData.quantity || !saleData.pricePerUnit) {\n      alert('Por favor, completa todos los campos de la venta para generar la factura.');\n      return;\n    }\n  \n    const precioUnitario = parseFloat(saleData.pricePerUnit || 0);\n    const cantidad = parseFloat(saleData.quantity || 0);\n    const total = cantidad * precioUnitario;\n  \n    const tempDiv = document.createElement('div');\n    tempDiv.style.width = '210mm'; // A4 width\n    tempDiv.style.padding = '15mm'; // Padding para el contenido\n    tempDiv.style.fontFamily = 'Arial, sans-serif';\n    tempDiv.style.fontSize = '10pt';\n    tempDiv.style.backgroundColor = '#f8f8f8'; // Fondo ligeramente gris\n    tempDiv.style.position = 'absolute';\n    tempDiv.style.left = '-9999px';\n    tempDiv.style.top = '-9999px';\n  \n    tempDiv.innerHTML = `\n      <div style=\"border: 1px solid #ddd; border-radius: 12px; overflow: hidden; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1);\">\n        <div style=\"background-color: #2c3e50; color: #fff; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-top-left-radius: 10px; border-top-right-radius: 10px;\">\n          <img src=\"${logoUrl || defaultLogo}\" style=\"width: 80px; height: 80px; border-radius: 50%; object-fit: cover;\" alt=\"Logo Finca\">\n          <div style=\"text-align: right;\">\n            <h1 style=\"margin: 0; font-size: 24pt; font-weight: bold;\">${farmName}</h1>\n            <p style=\"margin: 0; font-size: 12pt; opacity: 0.8;\">Factura de Venta</p>\n          </div>\n        </div>\n  \n        <div style=\"padding: 25px;\">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 20px;\">\n            <div>\n              <p style=\"margin: 0;\"><strong>Factura ID:</strong> ${saleData.id || 'N/A'}</p>\n              <p style=\"margin: 0;\"><strong>Fecha:</strong> ${saleData.date || 'N/A'}</p>\n            </div>\n            <div style=\"text-align: right;\">\n              <p style=\"margin: 0;\"><strong>Cliente:</strong> ${saleData.client || 'N/A'}</p>\n              <p style=\"margin: 0;\"><strong>Descripción:</strong> ${saleData.description || 'Venta de productos'}</p>\n            </div>\n          </div>\n  \n          <table style=\"width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 30px;\">\n            <thead style=\"background-color: #f0f0f0;\">\n              <tr>\n                <th style=\"padding: 12px; border: 1px solid #eee; text-align: left;\">Producto</th>\n                <th style=\"padding: 12px; border: 1px solid #eee; text-align: left;\">Cantidad</th>\n                <th style=\"padding: 12px; border: 1px solid #eee; text-align: left;\">Unidad</th>\n                <th style=\"padding: 12px; border: 1px solid #eee; text-align: left;\">Precio Unitario</th>\n                <th style=\"padding: 12px; border: 1px solid #eee; text-align: left;\">Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td style=\"padding: 12px; border: 1px solid #eee;\">${saleData.product}</td>\n                <td style=\"padding: 12px; border: 1px solid #eee;\">${saleData.quantity}</td>\n                <td style=\"padding: 12px; border: 1px solid #eee;\">${saleData.unit}</td>\n                <td style=\"padding: 12px; border: 1px solid #eee;\">$${precioUnitario.toFixed(2)}</td>\n                <td style=\"padding: 12px; border: 1px solid #eee;\">$${total.toFixed(2)}</td>\n              </tr>\n            </tbody>\n          </table>\n  \n          <div style=\"text-align: right; margin-top: 20px;\">\n            <p style=\"font-size: 14pt; font-weight: bold; color: #2c3e50; margin: 0;\">Total a Pagar: <span style=\"color: #27ae60;\">$${total.toFixed(2)}</span></p>\n          </div>\n        </div>\n  \n        <div style=\"text-align: center; padding: 20px; background-color: #f0f0f0; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;\">\n          <p style=\"font-size: 9pt; color: #555; margin: 0;\">¡Gracias por tu compra!</p>\n        </div>\n  \n        <div style=\"text-align: right; font-size: 8pt; padding: 10px 20px; color: #aaa; background-color: #f8f8f8; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;\">\n          <p style=\"margin: 0;\">Generado por Campo Inteligente | Administrador: ${adminName}</p>\n          <p style=\"margin: 0;\">Fecha de Generación: ${new Date().toLocaleDateString()}</p>\n        </div>\n      </div>\n    `;\n  \n    document.body.appendChild(tempDiv);\n  \n    html2canvas(tempDiv, { scale: 2, useCORS: true }).then(canvas => {\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF('p', 'mm', 'a4');\n      const imgWidth = 210;\n      const pageHeight = 297;\n      const imgHeight = canvas.height * imgWidth / canvas.width;\n      let heightLeft = imgHeight;\n      let position = 0;\n  \n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n  \n      while (heightLeft >= pageHeight) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n  \n      pdf.save(`factura_${saleData.client || 'sin_cliente'}_${saleData.id || 'sin_id'}.pdf`);\n      document.body.removeChild(tempDiv);\n    });\n  };\n\n  return (\n    <div className=\"bg-white p-6 rounded-lg shadow-md\">\n      <h3 className=\"text-xl font-semibold mb-4\">Gestión Económica</h3>\n\n      <EconomicReportSummary\n        reportPeriod={reportPeriod}\n        selectedDate={selectedDate}\n        selectedMonth={selectedMonth}\n        selectedWeek={selectedWeek}\n        setSelectedDate={setSelectedDate}\n        setSelectedMonth={setSelectedMonth}\n        setReportPeriod={setReportPeriod}\n        totalIncomePeriod={totalIncomePeriod}\n        totalExpensesPeriod={totalExpensesPeriod}\n        netProfitPeriod={netProfitPeriod}\n      />\n\n      <AnimalProfitabilitySection\n        animalProfitability={animalProfitability}\n        totalSharedExpenses={totalSharedExpenses}\n        sharedExpensesBreakdown={sharedExpensesBreakdown}\n      />\n\n      <TransactionForm\n        transaction={transaction}\n        handleInputChange={(e) => setTransaction({ ...transaction, [e.target.name]: e.target.value })}\n        handleSubmit={handleSubmit}\n        handleGenerateInvoice={handleGenerateInvoice}\n        animals={safeAnimals}\n        calculateTotalSale={calculateTotalSale} // Pass calculateTotalSale to TransactionForm\n        suppliers={suppliers}\n        clients={clients}\n        addSupplier={addSupplier}\n        addClient={addClient}\n        debts={debts}\n        credits={credits}\n        addDebt={addDebt}\n        payDebt={payDebt}\n        addCredit={addCredit}\n        collectCredit={collectCredit}\n      />\n\n      <TransactionHistory\n        transactions={transactions}\n        onDeleteTransaction={onDeleteTransaction}\n        handleGenerateInvoice={handleGenerateInvoice}\n      />\n\n      <SupplierClientManagement\n        suppliers={suppliers}\n        clients={clients}\n        debts={debts}\n        credits={credits}\n        addSupplier={addSupplier}\n        addClient={addClient}\n        addDebt={addDebt}\n        payDebt={payDebt}\n        addCredit={addCredit}\n        collectCredit={collectCredit}\n      />\n    </div>\n  );\n};\n\nexport default EconomicManagementPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}